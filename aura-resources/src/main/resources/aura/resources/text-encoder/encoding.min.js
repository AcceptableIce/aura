// https://github.com/inexorabletash/text-encoding v0.6.0
// Stripped to only support utf-8 and utf-16
// This is free and unencumbered software released into the public domain.
!function(e){"use strict";function n(e,n,r){return e>=n&&r>=e}function r(e,n){return-1!==e.indexOf(n)}function t(e){if(void 0===e)return{};if(e===Object(e))return e;throw TypeError("Could not convert argument to dictionary")}function o(e){for(var n=String(e),r=n.length,t=0,o=[];r>t;){var i=n.charCodeAt(t);if(55296>i||i>57343)o.push(i);else if(i>=56320&&57343>=i)o.push(65533);else if(i>=55296&&56319>=i)if(t===r-1)o.push(65533);else{var a=e.charCodeAt(t+1);if(a>=56320&&57343>=a){var f=1023&i,u=1023&a;o.push(65536+(f<<10)+u),t+=1}else o.push(65533)}t+=1}return o}function i(e){for(var n="",r=0;r<e.length;++r){var t=e[r];65535>=t?n+=String.fromCharCode(t):(t-=65536,n+=String.fromCharCode((t>>10)+55296,(1023&t)+56320))}return n}function a(e){this.tokens=[].slice.call(e),this.tokens.reverse()}function f(e,n){if(e)throw TypeError("Decoder error");return n||65533}function u(){}function s(){}function l(e){return e=String(e).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(b,e)?b[e]:null}function c(e,n){if(!(this instanceof c))throw TypeError("Called as a function. Did you forget 'new'?");e=void 0!==e?String(e):E,n=t(n),this._encoding=null,this._decoder=null,this._ignoreBOM=!1,this._BOMseen=!1,this._error_mode="replacement",this._do_not_flush=!1;var r=l(e);if(null===r||"replacement"===r.name)throw RangeError("Unknown encoding: "+e);if(!B[r.name])throw Error("Decoder not present. Did you forget to include encoding-indexes.js?");var o=this;return o._encoding=r,Boolean(n.fatal)&&(o._error_mode="fatal"),Boolean(n.ignoreBOM)&&(o._ignoreBOM=!0),Object.defineProperty||(this.encoding=o._encoding.name.toLowerCase(),this.fatal="fatal"===o._error_mode,this.ignoreBOM=o._ignoreBOM),o}function h(n,r){if(!(this instanceof h))throw TypeError("Called as a function. Did you forget 'new'?");r=t(r),this._encoding=null,this._encoder=null,this._do_not_flush=!1,this._fatal=Boolean(r.fatal)?"fatal":"replacement";var o=this;if(Boolean(r.NONSTANDARD_allowLegacyEncoding)){n=void 0!==n?String(n):E;var i=l(n);if(null===i||"replacement"===i.name)throw RangeError("Unknown encoding: "+n);if(!O[i.name])throw Error("Encoder not present. Did you forget to include encoding-indexes.js?");o._encoding=i}else o._encoding=l("utf-8"),void 0!==n&&"console"in e&&console.warn("TextEncoder constructor called with encoding label, which is ignored.");return Object.defineProperty||(this.encoding=o._encoding.name.toLowerCase()),o}function d(e){var r=e.fatal,t=0,o=0,i=0,a=128,u=191;this.handler=function(e,s){if(s===v&&0!==i)return i=0,f(r);if(s===v)return w;if(0===i){if(n(s,0,127))return s;if(n(s,194,223))i=1,t=s-192;else if(n(s,224,239))224===s&&(a=160),237===s&&(u=159),i=2,t=s-224;else{if(!n(s,240,244))return f(r);240===s&&(a=144),244===s&&(u=143),i=3,t=s-240}return t<<=6*i,null}if(!n(s,a,u))return t=i=o=0,a=128,u=191,e.prepend(s),f(r);if(a=128,u=191,o+=1,t+=s-128<<6*(i-o),o!==i)return null;var l=t;return t=i=o=0,l}}function p(e){e.fatal;this.handler=function(e,r){if(r===v)return w;if(n(r,0,127))return r;var t,o;n(r,128,2047)?(t=1,o=192):n(r,2048,65535)?(t=2,o=224):n(r,65536,1114111)&&(t=3,o=240);for(var i=[(r>>6*t)+o];t>0;){var a=r>>6*(t-1);i.push(128|63&a),t-=1}return i}}function _(e,n){var r=e>>8,t=255&e;return n?[r,t]:[t,r]}function g(e,r){var t=r.fatal,o=null,i=null;this.handler=function(r,a){if(a===v&&(null!==o||null!==i))return f(t);if(a===v&&null===o&&null===i)return w;if(null===o)return o=a,null;var u;if(u=e?(o<<8)+a:(a<<8)+o,o=null,null!==i){var s=i;return i=null,n(u,56320,57343)?65536+1024*(s-55296)+(u-56320):(r.prepend(_(u,e)),f(t))}return n(u,55296,56319)?(i=u,null):n(u,56320,57343)?f(t):u}}function y(e,r){r.fatal;this.handler=function(r,t){if(t===v)return w;if(n(t,0,65535))return _(t,e);var o=_((t-65536>>10)+55296,e),i=_((t-65536&1023)+56320,e);return o.concat(i)}}var v=-1;a.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.pop():v},prepend:function(e){if(Array.isArray(e))for(var n=e;n.length;)this.tokens.push(n.pop());else this.tokens.push(e)},push:function(e){if(Array.isArray(e))for(var n=e;n.length;)this.tokens.unshift(n.shift());else this.tokens.unshift(e)}};var w=-1;u.prototype={handler:function(e,n){}},s.prototype={handler:function(e,n){}};var m=[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"UTF-8"}],heading:"The Encoding"},{encodings:[{labels:["utf-16be"],name:"UTF-16BE"},{labels:["utf-16","utf-16le"],name:"UTF-16LE"}],heading:"Legacy miscellaneous encodings"}],b={};m.forEach(function(e){e.encodings.forEach(function(e){e.labels.forEach(function(n){b[n]=e})})});var O={},B={},E="utf-8";Object.defineProperty&&(Object.defineProperty(c.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}}),Object.defineProperty(c.prototype,"fatal",{get:function(){return"fatal"===this._error_mode}}),Object.defineProperty(c.prototype,"ignoreBOM",{get:function(){return this._ignoreBOM}})),c.prototype.decode=function(e,n){function o(e){return!r(["UTF-8","UTF-16LE","UTF-16BE"],this._encoding.name)||this._ignoreBOM||this._BOMseen||(e.length>0&&65279===e[0]?(this._BOMseen=!0,e.shift()):e.length>0&&(this._BOMseen=!0)),i(e)}var f;f="object"==typeof e&&e instanceof ArrayBuffer?new Uint8Array(e):"object"==typeof e&&"buffer"in e&&e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(0),n=t(n),this._do_not_flush||(this._decoder=B[this._encoding.name]({fatal:"fatal"===this._error_mode}),this._BOMseen=!1),this._do_not_flush=Boolean(n.stream);for(var u,s=new a(f),l=[];;){var c=s.read();if(c===v)break;if(u=this._decoder.handler(s,c),u===w)break;null!==u&&(Array.isArray(u)?l.push.apply(l,u):l.push(u))}if(!this._do_not_flush){do{if(u=this._decoder.handler(s,s.read()),u===w)break;null!==u&&(Array.isArray(u)?l.push.apply(l,u):l.push(u))}while(!s.endOfStream());this._decoder=null}return o.call(this,l)},Object.defineProperty&&Object.defineProperty(h.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}}),h.prototype.encode=function(e,n){e=e?String(e):"",n=t(n),this._do_not_flush||(this._encoder=O[this._encoding.name]({fatal:"fatal"===this._fatal})),this._do_not_flush=Boolean(n.stream);for(var r,i=new a(o(e)),f=[];;){var u=i.read();if(u===v)break;if(r=this._encoder.handler(i,u),r===w)break;Array.isArray(r)?f.push.apply(f,r):f.push(r)}if(!this._do_not_flush){for(;;){if(r=this._encoder.handler(i,i.read()),r===w)break;Array.isArray(r)?f.push.apply(f,r):f.push(r)}this._encoder=null}return new Uint8Array(f)},O["UTF-8"]=function(e){return new p(e)},B["UTF-8"]=function(e){return new d(e)},O["UTF-16BE"]=function(e){return new y(!0,e)},B["UTF-16BE"]=function(e){return new g(!0,e)},O["UTF-16LE"]=function(e){return new y(!1,e)},B["UTF-16LE"]=function(e){return new g(!1,e)},e.TextEncoder||(e.TextEncoder=h),e.TextDecoder||(e.TextDecoder=c)}(window);